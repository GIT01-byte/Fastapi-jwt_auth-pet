
# Fastapi-jwt_auth-pet

## üöÄ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?
–≠—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π API-—Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –±–∞–∑–µ FastAPI, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π JWT (EdDSA) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏.
–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ü–∏–∫–ª: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π (Blacklist –≤ Redis).

## ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

*   Python 3.9+
*   Docker & Docker Compose ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (PostgreSQL, Redis).

## üõ† –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/GIT01-byte/Fastapi-jwt_auth-pet
cd "Fastapi-jwt_auth-pet"
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
1. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ .env.example –≤ .env.
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–≤–æ–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ü—Ä–∏–º–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ Docker:
```env
APP__CONFIG__DB__HOST=postgres
APP__CONFIG__DB__PORT=5432
APP__CONFIG__DB__USER=user
APP__CONFIG__DB__PWD=password
APP__CONFIG__DB__NAME=my_database

APP__CONFIG__REDIS__HOST=redis
APP__CONFIG__REDIS__PORT=6379

APP__CONFIG__MODE=DEV
```
*–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–±–µ–∑ Docker) –∑–∞–º–µ–Ω–∏—Ç–µ postgres –∏ redis –Ω–∞ localhost.*

### 3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (EdDSA):
–î–ª—è —Ä–∞–±–æ—Ç—ã JWT –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä—É –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–µ–π:

```bash
python ./backend/auth/utils/gen_keys.py
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ Docker:
```bash
docker-compose up --build -d
```


# üìë –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Auth Service)

–ë–∞–∑–æ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤: http://localhost:8080/users

## 1. –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–ê–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø)

### üì• –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
*   URL: /register/
*   –ú–µ—Ç–æ–¥: POST
*   JSON Body:    {
      "username": "ivan_ivanov",
      "email": "ivan@example.com",
      "password": "strong_password_123",
      "profile": {} 
    }
    
### üîë –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (Login)
–í—ã–¥–∞–µ—Ç Access/Refresh —Ç–æ–∫–µ–Ω—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö –≤ HttpOnly Cookies.
*   URL: /login/
*   –ú–µ—Ç–æ–¥: POST
*   –§–æ—Ä–º–∞—Ç: x-www-form-urlencoded (OAuth2 standard)
*   –ü–æ–ª—è: username, password

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (Refresh)
*   URL: /tokens/refresh/
*   –ú–µ—Ç–æ–¥: POST
*   JSON Body: {"refresh_token": "your_token_here"}


## 2. –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–¢—Ä–µ–±—É–µ—Ç—Å—è JWT)
*–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization: Bearer <access_token> –∏–ª–∏ –Ω–∞–ª–∏—á–∏–µ Cookies.*

### üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ
*   URL: /me/
*   –ú–µ—Ç–æ–¥: GET
*   –û—Ç–≤–µ—Ç: –î–∞–Ω–Ω—ã–µ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –≤—Ä–µ–º—è –≤—Ö–æ–¥–∞.

### üö™ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (Logout)
*   URL: /logout/
*   –ú–µ—Ç–æ–¥: POST
*   –î–µ–π—Å—Ç–≤–∏–µ: –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω –≤ Redis, —É–¥–∞–ª—è–µ—Ç —Å–µ—Å—Å–∏—é –∏–∑ –ë–î –∏ –æ—á–∏—â–∞–µ—Ç Cookies.


## üõ† –ü—Ä–∏–º–µ—Ä—ã –≤—ã–∑–æ–≤–æ–≤ (cURL)

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
```
curl -X POST "http://localhost:8080/users/register/" \
     -H "Content-Type: application/json" \
     -d '{"username": "testuser", "email": "test@test.ru", "password": "password123", "profile": {}}'
```
–õ–æ–≥–∏–Ω:
```
curl -X POST "http://localhost:8080/users/login/" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=testuser&password=password123"
```

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

 ‚Ä¢  Swagger UI (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è): http://localhost:8080/docs
 ‚Ä¢  ReDoc (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è): http://localhost:8080/redoc
 ‚Ä¢  –ú–µ—Ç—Ä–∏–∫–∏ Prometheus: http://localhost:8080/metrics (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
 ‚Ä¢  –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: http://localhost:8080/admin (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
